<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='å‰è¨€ ç”±äºç½‘ä¸Šå¤§éƒ¨åˆ†è‡ªå®šä¹‰ç›¸æœºçš„å®ç°ï¼Œéƒ½æ˜¯è€¦åˆæ€§æ¯”è¾ƒå¼ºçš„ï¼Œä¸æ–¹ä¾¿ä»Šåçš„å¤ç”¨ï¼Œæ‰€ä»¥æˆ‘è‡ªå·±å®ç°äº†ä¸€å¥—è‡ªå®šä¹‰ç›¸æœºï¼Œæ–¹ä¾¿ä»¥åçš„æ‰©å±•ã€‚è‡ªå®šä¹‰ç›¸æœºåˆ†ä¸ºä»¥ä¸‹3ä¸ªéƒ¨åˆ†ã€‚
ç›¸æœºçš„é¢„è§ˆå¸ƒå±€SurfaceView ï¼Œæ–¹ä¾¿ç”¨æˆ·å®æ—¶é¢„è§ˆã€‚å†™æˆè‡ªå®šä¹‰æ§ä»¶ï¼Œæ–¹ä¾¿ä»Šåçš„å¤ç”¨ã€‚ ç›¸æœºçš„è‡ªåŠ¨èšç„¦ä»¥åŠç‚¹è§¦èšç„¦ï¼Œæ‹ç…§éœ€è¦èšç„¦ï¼Œè¦ä¸ç„¶æ‹å‡ºçš„å›¾ç‰‡å¾ˆå¯èƒ½æ˜¯æ¨¡ç³Šçš„ã€‚å†™æˆè‡ªå®šä¹‰æ§ä»¶ï¼Œæ–¹ä¾¿ä»Šåçš„å¤ç”¨ã€‚ ç›¸æœºçš„è‡ªå®šä¹‰å¸ƒå±€ï¼Œè¿™éƒ¨åˆ†éšç€éœ€æ±‚çš„è¿­ä»£å˜æ¢ï¼Œå‰é¢çš„2å¤§å—ä¸éœ€è¦æ”¹åŠ¨ã€‚ ä¸€ã€é¢„è§ˆå¸ƒå±€çš„å®ç° ï¼ˆ1ï¼‰ æŠ½ç¦»é¢„è§ˆå›¾å±‚ä¸ºä¸€ä¸ªå•ç‹¬çš„è‡ªå®šä¹‰æ§ä»¶CameraPreview ï¼Œä¼ é€’Camreå¯¹è±¡ï¼Œè®¾ç½®å¿…è¦çš„ç›¸æœºé¢„è§ˆå‚æ•°ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 package com.'>
<title>Androidè‡ªå®šä¹‰æ‹ç…§å®ç°</title>

<link rel='canonical' href='https://rmondjone.github.io/posts/mobile/android_camre/'>

<link rel="stylesheet" href="/scss/style.min.8191399262444ab68b72a18c97392f5349be20a1615d77445be51e974c144cff.css"><meta property='og:title' content='Androidè‡ªå®šä¹‰æ‹ç…§å®ç°'>
<meta property='og:description' content='å‰è¨€ ç”±äºç½‘ä¸Šå¤§éƒ¨åˆ†è‡ªå®šä¹‰ç›¸æœºçš„å®ç°ï¼Œéƒ½æ˜¯è€¦åˆæ€§æ¯”è¾ƒå¼ºçš„ï¼Œä¸æ–¹ä¾¿ä»Šåçš„å¤ç”¨ï¼Œæ‰€ä»¥æˆ‘è‡ªå·±å®ç°äº†ä¸€å¥—è‡ªå®šä¹‰ç›¸æœºï¼Œæ–¹ä¾¿ä»¥åçš„æ‰©å±•ã€‚è‡ªå®šä¹‰ç›¸æœºåˆ†ä¸ºä»¥ä¸‹3ä¸ªéƒ¨åˆ†ã€‚
ç›¸æœºçš„é¢„è§ˆå¸ƒå±€SurfaceView ï¼Œæ–¹ä¾¿ç”¨æˆ·å®æ—¶é¢„è§ˆã€‚å†™æˆè‡ªå®šä¹‰æ§ä»¶ï¼Œæ–¹ä¾¿ä»Šåçš„å¤ç”¨ã€‚ ç›¸æœºçš„è‡ªåŠ¨èšç„¦ä»¥åŠç‚¹è§¦èšç„¦ï¼Œæ‹ç…§éœ€è¦èšç„¦ï¼Œè¦ä¸ç„¶æ‹å‡ºçš„å›¾ç‰‡å¾ˆå¯èƒ½æ˜¯æ¨¡ç³Šçš„ã€‚å†™æˆè‡ªå®šä¹‰æ§ä»¶ï¼Œæ–¹ä¾¿ä»Šåçš„å¤ç”¨ã€‚ ç›¸æœºçš„è‡ªå®šä¹‰å¸ƒå±€ï¼Œè¿™éƒ¨åˆ†éšç€éœ€æ±‚çš„è¿­ä»£å˜æ¢ï¼Œå‰é¢çš„2å¤§å—ä¸éœ€è¦æ”¹åŠ¨ã€‚ ä¸€ã€é¢„è§ˆå¸ƒå±€çš„å®ç° ï¼ˆ1ï¼‰ æŠ½ç¦»é¢„è§ˆå›¾å±‚ä¸ºä¸€ä¸ªå•ç‹¬çš„è‡ªå®šä¹‰æ§ä»¶CameraPreview ï¼Œä¼ é€’Camreå¯¹è±¡ï¼Œè®¾ç½®å¿…è¦çš„ç›¸æœºé¢„è§ˆå‚æ•°ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 package com.'>
<meta property='og:url' content='https://rmondjone.github.io/posts/mobile/android_camre/'>
<meta property='og:site_name' content='éƒ­ç¿°æ—çš„åšå®¢'>
<meta property='og:type' content='article'><meta property='article:section' content='Posts' /><meta property='article:tag' content='Android' /><meta property='article:published_time' content='2023-04-07T10:30:23&#43;08:00'/><meta property='article:modified_time' content='2023-04-07T10:30:23&#43;08:00'/>
<meta name="twitter:title" content="Androidè‡ªå®šä¹‰æ‹ç…§å®ç°">
<meta name="twitter:description" content="å‰è¨€ ç”±äºç½‘ä¸Šå¤§éƒ¨åˆ†è‡ªå®šä¹‰ç›¸æœºçš„å®ç°ï¼Œéƒ½æ˜¯è€¦åˆæ€§æ¯”è¾ƒå¼ºçš„ï¼Œä¸æ–¹ä¾¿ä»Šåçš„å¤ç”¨ï¼Œæ‰€ä»¥æˆ‘è‡ªå·±å®ç°äº†ä¸€å¥—è‡ªå®šä¹‰ç›¸æœºï¼Œæ–¹ä¾¿ä»¥åçš„æ‰©å±•ã€‚è‡ªå®šä¹‰ç›¸æœºåˆ†ä¸ºä»¥ä¸‹3ä¸ªéƒ¨åˆ†ã€‚
ç›¸æœºçš„é¢„è§ˆå¸ƒå±€SurfaceView ï¼Œæ–¹ä¾¿ç”¨æˆ·å®æ—¶é¢„è§ˆã€‚å†™æˆè‡ªå®šä¹‰æ§ä»¶ï¼Œæ–¹ä¾¿ä»Šåçš„å¤ç”¨ã€‚ ç›¸æœºçš„è‡ªåŠ¨èšç„¦ä»¥åŠç‚¹è§¦èšç„¦ï¼Œæ‹ç…§éœ€è¦èšç„¦ï¼Œè¦ä¸ç„¶æ‹å‡ºçš„å›¾ç‰‡å¾ˆå¯èƒ½æ˜¯æ¨¡ç³Šçš„ã€‚å†™æˆè‡ªå®šä¹‰æ§ä»¶ï¼Œæ–¹ä¾¿ä»Šåçš„å¤ç”¨ã€‚ ç›¸æœºçš„è‡ªå®šä¹‰å¸ƒå±€ï¼Œè¿™éƒ¨åˆ†éšç€éœ€æ±‚çš„è¿­ä»£å˜æ¢ï¼Œå‰é¢çš„2å¤§å—ä¸éœ€è¦æ”¹åŠ¨ã€‚ ä¸€ã€é¢„è§ˆå¸ƒå±€çš„å®ç° ï¼ˆ1ï¼‰ æŠ½ç¦»é¢„è§ˆå›¾å±‚ä¸ºä¸€ä¸ªå•ç‹¬çš„è‡ªå®šä¹‰æ§ä»¶CameraPreview ï¼Œä¼ é€’Camreå¯¹è±¡ï¼Œè®¾ç½®å¿…è¦çš„ç›¸æœºé¢„è§ˆå‚æ•°ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 package com.">
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu5046a004738fe6196f796d96e16bab8b_7661_300x0_resize_q75_box.jpeg" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ¥</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">éƒ­ç¿°æ—çš„åšå®¢</a></h1>
            <h2 class="site-description">ç§»åŠ¨ç«¯å¼€å‘å·¥ç¨‹å¸ˆ</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://github.com/RmondJone/'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com/RmondJone'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>é¦–é¡µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>æ–‡ç« </span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>æœç´¢</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E%E6%88%91/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>å…³äºæˆ‘</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>æš—è‰²æ¨¡å¼</span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li>
      <ol>
        <li><a href="#å‰è¨€">å‰è¨€</a></li>
        <li><a href="#ä¸€é¢„è§ˆå¸ƒå±€çš„å®ç°">ä¸€ã€é¢„è§ˆå¸ƒå±€çš„å®ç°</a>
          <ol>
            <li></li>
          </ol>
        </li>
        <li><a href="#äºŒç›¸æœºç‚¹è§¦è‡ªåŠ¨èšç„¦å¹¶ç»˜åˆ¶å¯¹ç„¦æ¡†çš„å®ç°">äºŒã€ç›¸æœºç‚¹è§¦è‡ªåŠ¨èšç„¦å¹¶ç»˜åˆ¶å¯¹ç„¦æ¡†çš„å®ç°</a>
          <ol>
            <li></li>
          </ol>
        </li>
        <li><a href="#ä¸‰è‡ªå®šä¹‰ç›¸æœºå¸ƒå±€">ä¸‰ã€è‡ªå®šä¹‰ç›¸æœºå¸ƒå±€</a>
          <ol>
            <li></li>
          </ol>
        </li>
        <li><a href="#å››demoé“¾æ¥">å››ã€Demoé“¾æ¥</a></li>
        <li><a href="#æ¬¢è¿star">æ¬¢è¿Star</a></li>
        <li><a href="#githubhttpsgithubcomrmondjoneandroidcamerahttpsgithubcomrmondjoneandroidcamera">GitHub:<a href="https://github.com/RmondJone/AndroidCamera">https://github.com/RmondJone/AndroidCamera</a></a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/%E7%A7%BB%E5%8A%A8%E7%AB%AF/" style="background-color: #2a6f8f; color: #fff;">
                ç§»åŠ¨ç«¯
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/posts/mobile/android_camre/">Androidè‡ªå®šä¹‰æ‹ç…§å®ç°</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Apr 07, 2023</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 22 åˆ†é’Ÿ
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h3 id="å‰è¨€">å‰è¨€</h3>
<p>ç”±äºç½‘ä¸Šå¤§éƒ¨åˆ†è‡ªå®šä¹‰ç›¸æœºçš„å®ç°ï¼Œéƒ½æ˜¯è€¦åˆæ€§æ¯”è¾ƒå¼ºçš„ï¼Œä¸æ–¹ä¾¿ä»Šåçš„å¤ç”¨ï¼Œæ‰€ä»¥æˆ‘è‡ªå·±å®ç°äº†ä¸€å¥—è‡ªå®šä¹‰ç›¸æœºï¼Œæ–¹ä¾¿ä»¥åçš„æ‰©å±•ã€‚è‡ªå®šä¹‰ç›¸æœºåˆ†ä¸ºä»¥ä¸‹3ä¸ªéƒ¨åˆ†ã€‚</p>
<ul>
<li>ç›¸æœºçš„é¢„è§ˆå¸ƒå±€SurfaceView ï¼Œæ–¹ä¾¿ç”¨æˆ·å®æ—¶é¢„è§ˆã€‚å†™æˆè‡ªå®šä¹‰æ§ä»¶ï¼Œæ–¹ä¾¿ä»Šåçš„å¤ç”¨ã€‚</li>
<li>ç›¸æœºçš„è‡ªåŠ¨èšç„¦ä»¥åŠç‚¹è§¦èšç„¦ï¼Œæ‹ç…§éœ€è¦èšç„¦ï¼Œè¦ä¸ç„¶æ‹å‡ºçš„å›¾ç‰‡å¾ˆå¯èƒ½æ˜¯æ¨¡ç³Šçš„ã€‚å†™æˆè‡ªå®šä¹‰æ§ä»¶ï¼Œæ–¹ä¾¿ä»Šåçš„å¤ç”¨ã€‚</li>
<li>ç›¸æœºçš„è‡ªå®šä¹‰å¸ƒå±€ï¼Œè¿™éƒ¨åˆ†éšç€éœ€æ±‚çš„è¿­ä»£å˜æ¢ï¼Œå‰é¢çš„2å¤§å—ä¸éœ€è¦æ”¹åŠ¨ã€‚
<img src="/images/camre_module.webp"
	
	
	
	loading="lazy"
	
	
></li>
</ul>
<h3 id="ä¸€é¢„è§ˆå¸ƒå±€çš„å®ç°">ä¸€ã€é¢„è§ˆå¸ƒå±€çš„å®ç°</h3>
<h6 id="1-æŠ½ç¦»é¢„è§ˆå›¾å±‚ä¸ºä¸€ä¸ªå•ç‹¬çš„è‡ªå®šä¹‰æ§ä»¶camerapreview-ä¼ é€’camreå¯¹è±¡è®¾ç½®å¿…è¦çš„ç›¸æœºé¢„è§ˆå‚æ•°">ï¼ˆ1ï¼‰ æŠ½ç¦»é¢„è§ˆå›¾å±‚ä¸ºä¸€ä¸ªå•ç‹¬çš„è‡ªå®šä¹‰æ§ä»¶CameraPreview ï¼Œä¼ é€’Camreå¯¹è±¡ï¼Œè®¾ç½®å¿…è¦çš„ç›¸æœºé¢„è§ˆå‚æ•°ã€‚</h6>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">com.focustech.xyz.baselibrary.camera</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.app.Activity</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.content.Context</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.graphics.ImageFormat</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.hardware.Camera</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.view.SurfaceHolder</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.view.SurfaceView</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.focustech.xyz.baselibrary.common.XyzLogger</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.SortedSet</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @author éƒ­ç¿°æ—
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @date 2019/2/28 0028 17:06
</span></span></span><span class="line"><span class="cl"><span class="cm"> * æ³¨é‡Š:ç›¸æœºé¢„è§ˆè§†å›¾
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CameraPreview</span> <span class="kd">extends</span> <span class="n">SurfaceView</span> <span class="kd">implements</span> <span class="n">SurfaceHolder</span><span class="o">.</span><span class="na">Callback</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">SurfaceHolder</span> <span class="n">mHolder</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Camera</span> <span class="n">mCamera</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">isPreview</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Context</span> <span class="n">context</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * é¢„è§ˆå°ºå¯¸é›†åˆ
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">SizeMap</span> <span class="n">mPreviewSizes</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SizeMap</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * å›¾ç‰‡å°ºå¯¸é›†åˆ
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">SizeMap</span> <span class="n">mPictureSizes</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SizeMap</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * å±å¹•æ—‹è½¬æ˜¾ç¤ºè§’åº¦
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mDisplayOrientation</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * è®¾å¤‡å±å®½æ¯”
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">AspectRatio</span> <span class="n">mAspectRatio</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ³¨é‡Šï¼šæ„é€ å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ—¶é—´ï¼š2019/2/28 0028 17:10
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ä½œè€…ï¼šéƒ­ç¿°æ—
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param context
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param mCamera
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">CameraPreview</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">Camera</span> <span class="n">mCamera</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">context</span> <span class="o">=</span> <span class="n">context</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">mCamera</span> <span class="o">=</span> <span class="n">mCamera</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">mHolder</span> <span class="o">=</span> <span class="n">getHolder</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">mHolder</span><span class="o">.</span><span class="na">addCallback</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">mHolder</span><span class="o">.</span><span class="na">setType</span><span class="o">(</span><span class="n">SurfaceHolder</span><span class="o">.</span><span class="na">SURFACE_TYPE_PUSH_BUFFERS</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">mDisplayOrientation</span> <span class="o">=</span> <span class="o">((</span><span class="n">Activity</span><span class="o">)</span> <span class="n">context</span><span class="o">).</span><span class="na">getWindowManager</span><span class="o">().</span><span class="na">getDefaultDisplay</span><span class="o">().</span><span class="na">getRotation</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">mAspectRatio</span> <span class="o">=</span> <span class="n">AspectRatio</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">16</span><span class="o">,</span> <span class="mi">9</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">surfaceCreated</span><span class="o">(</span><span class="n">SurfaceHolder</span> <span class="n">holder</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//è®¾ç½®è®¾å¤‡é«˜å®½æ¯”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">mAspectRatio</span> <span class="o">=</span> <span class="n">getDeviceAspectRatio</span><span class="o">((</span><span class="n">Activity</span><span class="o">)</span> <span class="n">context</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//è®¾ç½®é¢„è§ˆæ–¹å‘
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">mCamera</span><span class="o">.</span><span class="na">setDisplayOrientation</span><span class="o">(</span><span class="mi">90</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">Camera</span><span class="o">.</span><span class="na">Parameters</span> <span class="n">parameters</span> <span class="o">=</span> <span class="n">mCamera</span><span class="o">.</span><span class="na">getParameters</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//è·å–æ‰€æœ‰æ”¯æŒçš„é¢„è§ˆå°ºå¯¸
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">mPreviewSizes</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="o">(</span><span class="n">Camera</span><span class="o">.</span><span class="na">Size</span> <span class="n">size</span> <span class="o">:</span> <span class="n">parameters</span><span class="o">.</span><span class="na">getSupportedPreviewSizes</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">mPreviewSizes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Size</span><span class="o">(</span><span class="n">size</span><span class="o">.</span><span class="na">width</span><span class="o">,</span> <span class="n">size</span><span class="o">.</span><span class="na">height</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//è·å–æ‰€æœ‰æ”¯æŒçš„å›¾ç‰‡å°ºå¯¸
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">mPictureSizes</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="o">(</span><span class="n">Camera</span><span class="o">.</span><span class="na">Size</span> <span class="n">size</span> <span class="o">:</span> <span class="n">parameters</span><span class="o">.</span><span class="na">getSupportedPictureSizes</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">mPictureSizes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Size</span><span class="o">(</span><span class="n">size</span><span class="o">.</span><span class="na">width</span><span class="o">,</span> <span class="n">size</span><span class="o">.</span><span class="na">height</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">Size</span> <span class="n">previewSize</span> <span class="o">=</span> <span class="n">chooseOptimalSize</span><span class="o">(</span><span class="n">mPreviewSizes</span><span class="o">.</span><span class="na">sizes</span><span class="o">(</span><span class="n">mAspectRatio</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">            <span class="n">Size</span> <span class="n">pictureSize</span> <span class="o">=</span> <span class="n">mPictureSizes</span><span class="o">.</span><span class="na">sizes</span><span class="o">(</span><span class="n">mAspectRatio</span><span class="o">).</span><span class="na">last</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//è®¾ç½®ç›¸æœºå‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">parameters</span><span class="o">.</span><span class="na">setPreviewSize</span><span class="o">(</span><span class="n">previewSize</span><span class="o">.</span><span class="na">getWidth</span><span class="o">(),</span> <span class="n">previewSize</span><span class="o">.</span><span class="na">getHeight</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">            <span class="n">parameters</span><span class="o">.</span><span class="na">setPictureSize</span><span class="o">(</span><span class="n">pictureSize</span><span class="o">.</span><span class="na">getWidth</span><span class="o">(),</span> <span class="n">pictureSize</span><span class="o">.</span><span class="na">getHeight</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">            <span class="n">parameters</span><span class="o">.</span><span class="na">setPictureFormat</span><span class="o">(</span><span class="n">ImageFormat</span><span class="o">.</span><span class="na">JPEG</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">parameters</span><span class="o">.</span><span class="na">setRotation</span><span class="o">(</span><span class="mi">90</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">mCamera</span><span class="o">.</span><span class="na">setParameters</span><span class="o">(</span><span class="n">parameters</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//æŠŠè¿™ä¸ªé¢„è§ˆæ•ˆæœå±•ç¤ºåœ¨SurfaceViewä¸Šé¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">mCamera</span><span class="o">.</span><span class="na">setPreviewDisplay</span><span class="o">(</span><span class="n">holder</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//å¼€å¯é¢„è§ˆæ•ˆæœ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">mCamera</span><span class="o">.</span><span class="na">startPreview</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="n">isPreview</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">XyzLogger</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">&#34;CameraPreview&#34;</span><span class="o">,</span> <span class="s">&#34;ç›¸æœºé¢„è§ˆé”™è¯¯: &#34;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">surfaceChanged</span><span class="o">(</span><span class="n">SurfaceHolder</span> <span class="n">holder</span><span class="o">,</span> <span class="kt">int</span> <span class="n">format</span><span class="o">,</span> <span class="kt">int</span> <span class="n">width</span><span class="o">,</span> <span class="kt">int</span> <span class="n">height</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">holder</span><span class="o">.</span><span class="na">getSurface</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//åœæ­¢é¢„è§ˆæ•ˆæœ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">mCamera</span><span class="o">.</span><span class="na">stopPreview</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//é‡æ–°è®¾ç½®é¢„è§ˆæ•ˆæœ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">mCamera</span><span class="o">.</span><span class="na">setPreviewDisplay</span><span class="o">(</span><span class="n">mHolder</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">mCamera</span><span class="o">.</span><span class="na">startPreview</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">surfaceDestroyed</span><span class="o">(</span><span class="n">SurfaceHolder</span> <span class="n">holder</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">mCamera</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">isPreview</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//æ­£åœ¨é¢„è§ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">mCamera</span><span class="o">.</span><span class="na">stopPreview</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="n">mCamera</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ³¨é‡Šï¼šè·å–è®¾å¤‡å±å®½æ¯”
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ—¶é—´ï¼š2019/3/4 0004 12:55
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ä½œè€…ï¼šéƒ­ç¿°æ—
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">AspectRatio</span> <span class="nf">getDeviceAspectRatio</span><span class="o">(</span><span class="n">Activity</span> <span class="n">activity</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">width</span> <span class="o">=</span> <span class="n">activity</span><span class="o">.</span><span class="na">getWindow</span><span class="o">().</span><span class="na">getDecorView</span><span class="o">().</span><span class="na">getWidth</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">height</span> <span class="o">=</span> <span class="n">activity</span><span class="o">.</span><span class="na">getWindow</span><span class="o">().</span><span class="na">getDecorView</span><span class="o">().</span><span class="na">getHeight</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">AspectRatio</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">height</span><span class="o">,</span> <span class="n">width</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ³¨é‡Šï¼šé€‰æ‹©åˆé€‚çš„é¢„è§ˆå°ºå¯¸
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ—¶é—´ï¼š2019/3/4 0004 11:25
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ä½œè€…ï¼šéƒ­ç¿°æ—
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param sizes
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&#34;SuspiciousNameCombination&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Size</span> <span class="nf">chooseOptimalSize</span><span class="o">(</span><span class="n">SortedSet</span><span class="o">&lt;</span><span class="n">Size</span><span class="o">&gt;</span> <span class="n">sizes</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">desiredWidth</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">desiredHeight</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">final</span> <span class="kt">int</span> <span class="n">surfaceWidth</span> <span class="o">=</span> <span class="n">getWidth</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="kd">final</span> <span class="kt">int</span> <span class="n">surfaceHeight</span> <span class="o">=</span> <span class="n">getHeight</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">isLandscape</span><span class="o">(</span><span class="n">mDisplayOrientation</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">desiredWidth</span> <span class="o">=</span> <span class="n">surfaceHeight</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">desiredHeight</span> <span class="o">=</span> <span class="n">surfaceWidth</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">desiredWidth</span> <span class="o">=</span> <span class="n">surfaceWidth</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">desiredHeight</span> <span class="o">=</span> <span class="n">surfaceHeight</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">Size</span> <span class="n">result</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="n">Size</span> <span class="n">size</span> <span class="o">:</span> <span class="n">sizes</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">desiredWidth</span> <span class="o">&lt;=</span> <span class="n">size</span><span class="o">.</span><span class="na">getWidth</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="n">desiredHeight</span> <span class="o">&lt;=</span> <span class="n">size</span><span class="o">.</span><span class="na">getHeight</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">size</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span> <span class="o">=</span> <span class="n">size</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * Test if the supplied orientation is in landscape.
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param orientationDegrees Orientation in degrees (0,90,180,270)
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return True if in landscape, false if portrait
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">isLandscape</span><span class="o">(</span><span class="kt">int</span> <span class="n">orientationDegrees</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="o">(</span><span class="n">orientationDegrees</span> <span class="o">==</span> <span class="mi">90</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">                <span class="n">orientationDegrees</span> <span class="o">==</span> <span class="mi">270</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œæœ‰2å¤„åœ°æ–¹éœ€è¦æ³¨æ„ï¼Œç›¸æœºè¦è®¾ç½®æ­£ç¡®çš„é¢„è§ˆå°ºå¯¸å’Œæ­£ç¡®çš„å›¾ç‰‡çš„å°ºå¯¸ã€‚å¦‚æœé¢„è§ˆå°ºå¯¸è®¾ç½®é”™è¯¯ï¼Œåˆ™é¢„è§ˆå¸ƒå±€ä¼šè¢«æ‹‰ä¼¸æˆ–è€…æ”¶ç¼©ã€‚å¦‚æœå›¾ç‰‡å°ºå¯¸è®¾ç½®é”™è¯¯ï¼Œéƒ¨åˆ†æœºå‹ä¼šå¯¼è‡´é—ªé€€æˆ–è€…æ‹å‡ºçš„ç…§ç‰‡å¾ˆä¸æ¸…æ™°ã€‚</p>
<p>è¿™é‡Œé€‚é…é¢„è§ˆå°ºå¯¸å’Œå›¾ç‰‡å°ºå¯¸ï¼Œæ˜¯æ ¹æ®è®¾å¤‡çš„å±å®½æ¯”å’ŒCarmeæ‹¿åˆ°çš„è¯´æ”¯æŒçš„é¢„è§ˆå°ºå¯¸å’Œå›¾ç‰‡å°ºå¯¸è®¡ç®—å¾—å‡ºåº”æœ‰çš„é¢„è§ˆå°ºå¯¸å’Œå›¾ç‰‡å°ºå¯¸ï¼Œä»£ç å¦‚ä¸‹ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//è®¾ç½®è®¾å¤‡é«˜å®½æ¯”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">mAspectRatio</span> <span class="o">=</span> <span class="n">getDeviceAspectRatio</span><span class="o">((</span><span class="n">Activity</span><span class="o">)</span> <span class="n">context</span><span class="o">);.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Camera</span><span class="o">.</span><span class="na">Parameters</span> <span class="n">parameters</span> <span class="o">=</span> <span class="n">mCamera</span><span class="o">.</span><span class="na">getParameters</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="c1">//è·å–æ‰€æœ‰æ”¯æŒçš„é¢„è§ˆå°ºå¯¸
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">mPreviewSizes</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="o">(</span><span class="n">Camera</span><span class="o">.</span><span class="na">Size</span> <span class="n">size</span> <span class="o">:</span> <span class="n">parameters</span><span class="o">.</span><span class="na">getSupportedPreviewSizes</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">mPreviewSizes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Size</span><span class="o">(</span><span class="n">size</span><span class="o">.</span><span class="na">width</span><span class="o">,</span> <span class="n">size</span><span class="o">.</span><span class="na">height</span><span class="o">));</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//è·å–æ‰€æœ‰æ”¯æŒçš„å›¾ç‰‡å°ºå¯¸
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">mPictureSizes</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="o">(</span><span class="n">Camera</span><span class="o">.</span><span class="na">Size</span> <span class="n">size</span> <span class="o">:</span> <span class="n">parameters</span><span class="o">.</span><span class="na">getSupportedPictureSizes</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">mPictureSizes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Size</span><span class="o">(</span><span class="n">size</span><span class="o">.</span><span class="na">width</span><span class="o">,</span> <span class="n">size</span><span class="o">.</span><span class="na">height</span><span class="o">));</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="n">Size</span> <span class="n">previewSize</span> <span class="o">=</span> <span class="n">chooseOptimalSize</span><span class="o">(</span><span class="n">mPreviewSizes</span><span class="o">.</span><span class="na">sizes</span><span class="o">(</span><span class="n">mAspectRatio</span><span class="o">));</span>
</span></span><span class="line"><span class="cl"><span class="n">Size</span> <span class="n">pictureSize</span> <span class="o">=</span> <span class="n">mPictureSizes</span><span class="o">.</span><span class="na">sizes</span><span class="o">(</span><span class="n">mAspectRatio</span><span class="o">).</span><span class="na">last</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//è®¾ç½®ç›¸æœºå‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">parameters</span><span class="o">.</span><span class="na">setPreviewSize</span><span class="o">(</span><span class="n">previewSize</span><span class="o">.</span><span class="na">getWidth</span><span class="o">(),</span> <span class="n">previewSize</span><span class="o">.</span><span class="na">getHeight</span><span class="o">());</span>
</span></span><span class="line"><span class="cl"><span class="n">parameters</span><span class="o">.</span><span class="na">setPictureSize</span><span class="o">(</span><span class="n">pictureSize</span><span class="o">.</span><span class="na">getWidth</span><span class="o">(),</span> <span class="n">pictureSize</span><span class="o">.</span><span class="na">getHeight</span><span class="o">());</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * æ³¨é‡Šï¼šè·å–è®¾å¤‡å±å®½æ¯”
</span></span></span><span class="line"><span class="cl"><span class="cm"> * æ—¶é—´ï¼š2019/3/4 0004 12:55
</span></span></span><span class="line"><span class="cl"><span class="cm"> * ä½œè€…ï¼šéƒ­ç¿°æ—
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="n">AspectRatio</span> <span class="nf">getDeviceAspectRatio</span><span class="o">(</span><span class="n">Activity</span> <span class="n">activity</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">width</span> <span class="o">=</span> <span class="n">activity</span><span class="o">.</span><span class="na">getWindow</span><span class="o">().</span><span class="na">getDecorView</span><span class="o">().</span><span class="na">getWidth</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">height</span> <span class="o">=</span> <span class="n">activity</span><span class="o">.</span><span class="na">getWindow</span><span class="o">().</span><span class="na">getDecorView</span><span class="o">().</span><span class="na">getHeight</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">AspectRatio</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">height</span><span class="o">,</span> <span class="n">width</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * æ³¨é‡Šï¼šé€‰æ‹©åˆé€‚çš„é¢„è§ˆå°ºå¯¸
</span></span></span><span class="line"><span class="cl"><span class="cm"> * æ—¶é—´ï¼š2019/3/4 0004 11:25
</span></span></span><span class="line"><span class="cl"><span class="cm"> * ä½œè€…ï¼šéƒ­ç¿°æ—
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @param sizes
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @return
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&#34;SuspiciousNameCombination&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="n">Size</span> <span class="nf">chooseOptimalSize</span><span class="o">(</span><span class="n">SortedSet</span><span class="o">&lt;</span><span class="n">Size</span><span class="o">&gt;</span> <span class="n">sizes</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">desiredWidth</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">desiredHeight</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">final</span> <span class="kt">int</span> <span class="n">surfaceWidth</span> <span class="o">=</span> <span class="n">getWidth</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">final</span> <span class="kt">int</span> <span class="n">surfaceHeight</span> <span class="o">=</span> <span class="n">getHeight</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">isLandscape</span><span class="o">(</span><span class="n">mDisplayOrientation</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">desiredWidth</span> <span class="o">=</span> <span class="n">surfaceHeight</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">desiredHeight</span> <span class="o">=</span> <span class="n">surfaceWidth</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">desiredWidth</span> <span class="o">=</span> <span class="n">surfaceWidth</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">desiredHeight</span> <span class="o">=</span> <span class="n">surfaceHeight</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">Size</span> <span class="n">result</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="o">(</span><span class="n">Size</span> <span class="n">size</span> <span class="o">:</span> <span class="n">sizes</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">desiredWidth</span> <span class="o">&lt;=</span> <span class="n">size</span><span class="o">.</span><span class="na">getWidth</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="n">desiredHeight</span> <span class="o">&lt;=</span> <span class="n">size</span><span class="o">.</span><span class="na">getHeight</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">size</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="n">size</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h6 id="2å±å®½æ¯”aspectratioçš„å®ç°">ï¼ˆ2ï¼‰å±å®½æ¯”AspectRatioçš„å®ç°</h6>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">com.focustech.xyz.baselibrary.camera</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.os.Parcel</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.os.Parcelable</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.support.annotation.NonNull</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.support.v4.util.SparseArrayCompat</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @author éƒ­ç¿°æ—
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @date 2019/3/4 0004 11:11
</span></span></span><span class="line"><span class="cl"><span class="cm"> * æ³¨é‡Š:å±å®½æ¯”
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AspectRatio</span> <span class="kd">implements</span> <span class="n">Comparable</span><span class="o">&lt;</span><span class="n">AspectRatio</span><span class="o">&gt;,</span> <span class="n">Parcelable</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">SparseArrayCompat</span><span class="o">&lt;</span><span class="n">SparseArrayCompat</span><span class="o">&lt;</span><span class="n">AspectRatio</span><span class="o">&gt;&gt;</span> <span class="n">sCache</span>
</span></span><span class="line"><span class="cl">            <span class="o">=</span> <span class="k">new</span> <span class="n">SparseArrayCompat</span><span class="o">&lt;&gt;(</span><span class="mi">16</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">mX</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">mY</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * Returns an instance of {@link AspectRatio} specified by {@code x} and {@code y} values.
</span></span></span><span class="line"><span class="cl"><span class="cm">     * The values {@code x} and {@code} will be reduced by their greatest common divider.
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param x The width
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param y The height
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return An instance of {@link AspectRatio}
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">AspectRatio</span> <span class="nf">of</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">gcd</span> <span class="o">=</span> <span class="n">gcd</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">x</span> <span class="o">/=</span> <span class="n">gcd</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">y</span> <span class="o">/=</span> <span class="n">gcd</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">SparseArrayCompat</span><span class="o">&lt;</span><span class="n">AspectRatio</span><span class="o">&gt;</span> <span class="n">arrayX</span> <span class="o">=</span> <span class="n">sCache</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">x</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">arrayX</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">AspectRatio</span> <span class="n">ratio</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AspectRatio</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">arrayX</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SparseArrayCompat</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">            <span class="n">arrayX</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">y</span><span class="o">,</span> <span class="n">ratio</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">sCache</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">arrayX</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">ratio</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">AspectRatio</span> <span class="n">ratio</span> <span class="o">=</span> <span class="n">arrayX</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">y</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">ratio</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">ratio</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AspectRatio</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">arrayX</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">y</span><span class="o">,</span> <span class="n">ratio</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">ratio</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * Parse an {@link AspectRatio} from a {@link String} formatted like &#34;4:3&#34;.
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param s The string representation of the aspect ratio
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return The aspect ratio
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @throws IllegalArgumentException when the format is incorrect.
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">AspectRatio</span> <span class="nf">parse</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">position</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="sc">&#39;:&#39;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">position</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">&#34;Malformed aspect ratio: &#34;</span> <span class="o">+</span> <span class="n">s</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">position</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">            <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">AspectRatio</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NumberFormatException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">&#34;Malformed aspect ratio: &#34;</span> <span class="o">+</span> <span class="n">s</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">AspectRatio</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">mX</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">mY</span> <span class="o">=</span> <span class="n">y</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getX</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">mX</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getY</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">mY</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">matches</span><span class="o">(</span><span class="n">Size</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">gcd</span> <span class="o">=</span> <span class="n">gcd</span><span class="o">(</span><span class="n">size</span><span class="o">.</span><span class="na">getWidth</span><span class="o">(),</span> <span class="n">size</span><span class="o">.</span><span class="na">getHeight</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">size</span><span class="o">.</span><span class="na">getWidth</span><span class="o">()</span> <span class="o">/</span> <span class="n">gcd</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">size</span><span class="o">.</span><span class="na">getHeight</span><span class="o">()</span> <span class="o">/</span> <span class="n">gcd</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">mX</span> <span class="o">==</span> <span class="n">x</span> <span class="o">&amp;&amp;</span> <span class="n">mY</span> <span class="o">==</span> <span class="n">y</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">AspectRatio</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">AspectRatio</span> <span class="n">ratio</span> <span class="o">=</span> <span class="o">(</span><span class="n">AspectRatio</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">mX</span> <span class="o">==</span> <span class="n">ratio</span><span class="o">.</span><span class="na">mX</span> <span class="o">&amp;&amp;</span> <span class="n">mY</span> <span class="o">==</span> <span class="n">ratio</span><span class="o">.</span><span class="na">mY</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">mX</span> <span class="o">+</span> <span class="s">&#34;:&#34;</span> <span class="o">+</span> <span class="n">mY</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">float</span> <span class="nf">toFloat</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="o">(</span><span class="kt">float</span><span class="o">)</span> <span class="n">mX</span> <span class="o">/</span> <span class="n">mY</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// assuming most sizes are &lt;2^16, doing a rotate will give us perfect hashing
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="n">mY</span> <span class="o">^</span> <span class="o">((</span><span class="n">mX</span> <span class="o">&lt;&lt;</span> <span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">SIZE</span> <span class="o">/</span> <span class="mi">2</span><span class="o">))</span> <span class="o">|</span> <span class="o">(</span><span class="n">mX</span> <span class="o">&gt;&gt;&gt;</span> <span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">SIZE</span> <span class="o">/</span> <span class="mi">2</span><span class="o">)));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="n">AspectRatio</span> <span class="n">another</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">equals</span><span class="o">(</span><span class="n">another</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">toFloat</span><span class="o">()</span> <span class="o">-</span> <span class="n">another</span><span class="o">.</span><span class="na">toFloat</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="mi">1</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return The inverse of this {@link AspectRatio}.
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">AspectRatio</span> <span class="nf">inverse</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//noinspection SuspiciousNameCombination
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="n">AspectRatio</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">mY</span><span class="o">,</span> <span class="n">mX</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">gcd</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="o">(</span><span class="n">b</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="n">b</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">b</span> <span class="o">=</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">a</span> <span class="o">=</span> <span class="n">c</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">a</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">describeContents</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">writeToParcel</span><span class="o">(</span><span class="n">Parcel</span> <span class="n">dest</span><span class="o">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">dest</span><span class="o">.</span><span class="na">writeInt</span><span class="o">(</span><span class="n">mX</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">dest</span><span class="o">.</span><span class="na">writeInt</span><span class="o">(</span><span class="n">mY</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Parcelable</span><span class="o">.</span><span class="na">Creator</span><span class="o">&lt;</span><span class="n">AspectRatio</span><span class="o">&gt;</span> <span class="n">CREATOR</span>
</span></span><span class="line"><span class="cl">            <span class="o">=</span> <span class="k">new</span> <span class="n">Parcelable</span><span class="o">.</span><span class="na">Creator</span><span class="o">&lt;</span><span class="n">AspectRatio</span><span class="o">&gt;()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">AspectRatio</span> <span class="nf">createFromParcel</span><span class="o">(</span><span class="n">Parcel</span> <span class="n">source</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="na">readInt</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="na">readInt</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">AspectRatio</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">AspectRatio</span><span class="o">[]</span> <span class="nf">newArray</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">new</span> <span class="n">AspectRatio</span><span class="o">[</span><span class="n">size</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Copyright (C) 2016 The Android Open Source Project
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
</span></span></span><span class="line"><span class="cl"><span class="cm"> * you may not use this file except in compliance with the License.
</span></span></span><span class="line"><span class="cl"><span class="cm"> * You may obtain a copy of the License at
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> *      http://www.apache.org/licenses/LICENSE-2.0
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Unless required by applicable law or agreed to in writing, software
</span></span></span><span class="line"><span class="cl"><span class="cm"> * distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
</span></span></span><span class="line"><span class="cl"><span class="cm"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</span></span></span><span class="line"><span class="cl"><span class="cm"> * See the License for the specific language governing permissions and
</span></span></span><span class="line"><span class="cl"><span class="cm"> * limitations under the License.
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">com.focustech.xyz.baselibrary.camera</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.support.annotation.NonNull</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * æ³¨é‡Šï¼šå°ºå¯¸å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="cm"> * æ—¶é—´ï¼š2019/3/4 0004 11:14
</span></span></span><span class="line"><span class="cl"><span class="cm"> * ä½œè€…ï¼šéƒ­ç¿°æ—
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Size</span> <span class="kd">implements</span> <span class="n">Comparable</span><span class="o">&lt;</span><span class="n">Size</span><span class="o">&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">mWidth</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">mHeight</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * Create a new immutable Size instance.
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param width  The width of the size, in pixels
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param height The height of the size, in pixels
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">Size</span><span class="o">(</span><span class="kt">int</span> <span class="n">width</span><span class="o">,</span> <span class="kt">int</span> <span class="n">height</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">mWidth</span> <span class="o">=</span> <span class="n">width</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">mHeight</span> <span class="o">=</span> <span class="n">height</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getWidth</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">mWidth</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getHeight</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">mHeight</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">Size</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Size</span> <span class="n">size</span> <span class="o">=</span> <span class="o">(</span><span class="n">Size</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">mWidth</span> <span class="o">==</span> <span class="n">size</span><span class="o">.</span><span class="na">mWidth</span> <span class="o">&amp;&amp;</span> <span class="n">mHeight</span> <span class="o">==</span> <span class="n">size</span><span class="o">.</span><span class="na">mHeight</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">mWidth</span> <span class="o">+</span> <span class="s">&#34;x&#34;</span> <span class="o">+</span> <span class="n">mHeight</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// assuming most sizes are &lt;2^16, doing a rotate will give us perfect hashing
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="n">mHeight</span> <span class="o">^</span> <span class="o">((</span><span class="n">mWidth</span> <span class="o">&lt;&lt;</span> <span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">SIZE</span> <span class="o">/</span> <span class="mi">2</span><span class="o">))</span> <span class="o">|</span> <span class="o">(</span><span class="n">mWidth</span> <span class="o">&gt;&gt;&gt;</span> <span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">SIZE</span> <span class="o">/</span> <span class="mi">2</span><span class="o">)));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="n">Size</span> <span class="n">another</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">mWidth</span> <span class="o">*</span> <span class="n">mHeight</span> <span class="o">-</span> <span class="n">another</span><span class="o">.</span><span class="na">mWidth</span> <span class="o">*</span> <span class="n">another</span><span class="o">.</span><span class="na">mHeight</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">com.focustech.xyz.baselibrary.camera</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.support.v4.util.ArrayMap</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.Set</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.SortedSet</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.TreeSet</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @author éƒ­ç¿°æ—
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @date 2019/3/4 0004 11:13
</span></span></span><span class="line"><span class="cl"><span class="cm"> * æ³¨é‡Š:å°ºå¯¸é›†åˆ
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SizeMap</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">ArrayMap</span><span class="o">&lt;</span><span class="n">AspectRatio</span><span class="o">,</span> <span class="n">SortedSet</span><span class="o">&lt;</span><span class="n">Size</span><span class="o">&gt;&gt;</span> <span class="n">mRatios</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayMap</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * Add a new {@link Size} to this collection.
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param size The size to add.
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return {@code true} if it is added, {@code false} if it already exists and is not added.
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">add</span><span class="o">(</span><span class="n">Size</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="n">AspectRatio</span> <span class="n">ratio</span> <span class="o">:</span> <span class="n">mRatios</span><span class="o">.</span><span class="na">keySet</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">ratio</span><span class="o">.</span><span class="na">matches</span><span class="o">(</span><span class="n">size</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="kd">final</span> <span class="n">SortedSet</span><span class="o">&lt;</span><span class="n">Size</span><span class="o">&gt;</span> <span class="n">sizes</span> <span class="o">=</span> <span class="n">mRatios</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ratio</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">sizes</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">size</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">sizes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">size</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// None of the existing ratio matches the provided size; add a new key
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">SortedSet</span><span class="o">&lt;</span><span class="n">Size</span><span class="o">&gt;</span> <span class="n">sizes</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeSet</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">        <span class="n">sizes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">size</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">mRatios</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">AspectRatio</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">size</span><span class="o">.</span><span class="na">getWidth</span><span class="o">(),</span> <span class="n">size</span><span class="o">.</span><span class="na">getHeight</span><span class="o">()),</span> <span class="n">sizes</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * Removes the specified aspect ratio and all sizes associated with it.
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param ratio The aspect ratio to be removed.
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">(</span><span class="n">AspectRatio</span> <span class="n">ratio</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">mRatios</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">ratio</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Set</span><span class="o">&lt;</span><span class="n">AspectRatio</span><span class="o">&gt;</span> <span class="nf">ratios</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">mRatios</span><span class="o">.</span><span class="na">keySet</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">SortedSet</span><span class="o">&lt;</span><span class="n">Size</span><span class="o">&gt;</span> <span class="nf">sizes</span><span class="o">(</span><span class="n">AspectRatio</span> <span class="n">ratio</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">mRatios</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ratio</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">clear</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">mRatios</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">boolean</span> <span class="nf">isEmpty</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">mRatios</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="äºŒç›¸æœºç‚¹è§¦è‡ªåŠ¨èšç„¦å¹¶ç»˜åˆ¶å¯¹ç„¦æ¡†çš„å®ç°">äºŒã€ç›¸æœºç‚¹è§¦è‡ªåŠ¨èšç„¦å¹¶ç»˜åˆ¶å¯¹ç„¦æ¡†çš„å®ç°</h3>
<h6 id="1æŠ½ç¦»èšç„¦æ¡†ä¸ºå•ç‹¬çš„è‡ªå®šä¹‰ç»„ä»¶ä¼ é€’carmaå¯¹è±¡å’Œèšç„¦å›è°ƒè®¾ç½®å¿…è¦çš„ç›¸æœºå‚æ•°">ï¼ˆ1ï¼‰æŠ½ç¦»èšç„¦æ¡†ä¸ºå•ç‹¬çš„è‡ªå®šä¹‰ç»„ä»¶ï¼Œä¼ é€’Carmaå¯¹è±¡å’Œèšç„¦å›è°ƒï¼Œè®¾ç½®å¿…è¦çš„ç›¸æœºå‚æ•°</h6>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">com.focustech.xyz.baselibrary.camera</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.content.Context</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.graphics.Canvas</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.graphics.Color</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.graphics.Paint</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.graphics.Rect</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.hardware.Camera</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.support.v7.widget.AppCompatImageView</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.util.AttributeSet</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.view.WindowManager</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.focustech.xyz.baselibrary.common.XyzLogger</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @author éƒ­ç¿°æ—
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @date 2019/3/1 0001 9:21
</span></span></span><span class="line"><span class="cl"><span class="cm"> * æ³¨é‡Š:å¯¹ç„¦æ¡†
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OverCameraView</span> <span class="kd">extends</span> <span class="n">AppCompatImageView</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Context</span> <span class="n">context</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//ç„¦ç‚¹é™„è¿‘è®¾ç½®çŸ©å½¢åŒºåŸŸä½œä¸ºå¯¹ç„¦åŒºåŸŸ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">private</span> <span class="n">Rect</span> <span class="n">touchFocusRect</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Paint</span> <span class="n">touchFocusPaint</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//æ˜¯å¦æ­£åœ¨å¯¹ç„¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">isFoucuing</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">OverCameraView</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">OverCameraView</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">AttributeSet</span> <span class="n">attrs</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">attrs</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">OverCameraView</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">AttributeSet</span> <span class="n">attrs</span><span class="o">,</span> <span class="kt">int</span> <span class="n">defStyleAttr</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">attrs</span><span class="o">,</span> <span class="n">defStyleAttr</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">init</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">context</span> <span class="o">=</span> <span class="n">context</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//ç”»ç¬”è®¾ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">touchFocusPaint</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Paint</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">touchFocusPaint</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="n">Color</span><span class="o">.</span><span class="na">GREEN</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">touchFocusPaint</span><span class="o">.</span><span class="na">setStyle</span><span class="o">(</span><span class="n">Paint</span><span class="o">.</span><span class="na">Style</span><span class="o">.</span><span class="na">STROKE</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">touchFocusPaint</span><span class="o">.</span><span class="na">setStrokeWidth</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isFoucuing</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">isFoucuing</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFoucuing</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">foucuing</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">isFoucuing</span> <span class="o">=</span> <span class="n">foucuing</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ³¨é‡Šï¼šå¯¹ç„¦å¹¶ç»˜åˆ¶å¯¹ç„¦çŸ©å½¢æ¡†
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ—¶é—´ï¼š2019/3/1 0001 9:28
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ä½œè€…ï¼šéƒ­ç¿°æ—
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param camera
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param autoFocusCallback
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param x
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param y
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTouchFoucusRect</span><span class="o">(</span><span class="n">Camera</span> <span class="n">camera</span><span class="o">,</span> <span class="n">Camera</span><span class="o">.</span><span class="na">AutoFocusCallback</span> <span class="n">autoFocusCallback</span><span class="o">,</span> <span class="kt">float</span> <span class="n">x</span><span class="o">,</span> <span class="kt">float</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//ä»¥ç„¦ç‚¹ä¸ºä¸­å¿ƒï¼Œå®½åº¦ä¸º200çš„çŸ©å½¢æ¡†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">touchFocusRect</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Rect</span><span class="o">((</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">100</span><span class="o">),</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">y</span> <span class="o">-</span> <span class="mi">100</span><span class="o">),</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">100</span><span class="o">),</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">y</span> <span class="o">+</span> <span class="mi">100</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">//å¯¹ç„¦å…‰æ„ŸåŒºåŸŸ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kt">int</span> <span class="n">left</span> <span class="o">=</span> <span class="n">touchFocusRect</span><span class="o">.</span><span class="na">left</span> <span class="o">*</span> <span class="mi">2000</span> <span class="o">/</span> <span class="n">getWindowWidth</span><span class="o">(</span><span class="n">context</span><span class="o">)</span> <span class="o">-</span> <span class="mi">1000</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">top</span> <span class="o">=</span> <span class="n">touchFocusRect</span><span class="o">.</span><span class="na">top</span> <span class="o">*</span> <span class="mi">2000</span> <span class="o">/</span> <span class="n">getWindowHeight</span><span class="o">(</span><span class="n">context</span><span class="o">)</span> <span class="o">-</span> <span class="mi">1000</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">right</span> <span class="o">=</span> <span class="n">touchFocusRect</span><span class="o">.</span><span class="na">right</span> <span class="o">*</span> <span class="mi">2000</span> <span class="o">/</span> <span class="n">getWindowWidth</span><span class="o">(</span><span class="n">context</span><span class="o">)</span> <span class="o">-</span> <span class="mi">1000</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">bottom</span> <span class="o">=</span> <span class="n">touchFocusRect</span><span class="o">.</span><span class="na">bottom</span> <span class="o">*</span> <span class="mi">2000</span> <span class="o">/</span> <span class="n">getWindowHeight</span><span class="o">(</span><span class="n">context</span><span class="o">)</span> <span class="o">-</span> <span class="mi">1000</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// å¦‚æœè¶…å‡ºäº†(-1000,1000)åˆ°(1000, 1000)çš„èŒƒå›´ï¼Œåˆ™ä¼šå¯¼è‡´ç›¸æœºå´©æºƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">left</span> <span class="o">=</span> <span class="n">left</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1000</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1000</span> <span class="o">:</span> <span class="n">left</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">top</span> <span class="o">=</span> <span class="n">top</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1000</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1000</span> <span class="o">:</span> <span class="n">top</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">right</span> <span class="o">=</span> <span class="n">right</span> <span class="o">&gt;</span> <span class="mi">1000</span> <span class="o">?</span> <span class="mi">1000</span> <span class="o">:</span> <span class="n">right</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">bottom</span> <span class="o">=</span> <span class="n">bottom</span> <span class="o">&gt;</span> <span class="mi">1000</span> <span class="o">?</span> <span class="mi">1000</span> <span class="o">:</span> <span class="n">bottom</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">final</span> <span class="n">Rect</span> <span class="n">targetFocusRect</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Rect</span><span class="o">(</span><span class="n">left</span><span class="o">,</span> <span class="n">top</span><span class="o">,</span> <span class="n">right</span><span class="o">,</span> <span class="n">bottom</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">//å¯¹ç„¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">doTouchFocus</span><span class="o">(</span><span class="n">camera</span><span class="o">,</span> <span class="n">autoFocusCallback</span><span class="o">,</span> <span class="n">targetFocusRect</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//åˆ·æ–°ç•Œé¢ï¼Œè°ƒç”¨onDraw(Canvas canvas)å‡½æ•°ç»˜åˆ¶çŸ©å½¢æ¡†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">postInvalidate</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ³¨é‡Šï¼šè®¾ç½®cameraå‚æ•°ï¼Œå¹¶å®Œæˆå¯¹ç„¦
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ—¶é—´ï¼š2019/3/1 0001 9:27
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ä½œè€…ï¼šéƒ­ç¿°æ—
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param camera
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param autoFocusCallback
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param tfocusRect
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doTouchFocus</span><span class="o">(</span><span class="n">Camera</span> <span class="n">camera</span><span class="o">,</span> <span class="n">Camera</span><span class="o">.</span><span class="na">AutoFocusCallback</span> <span class="n">autoFocusCallback</span><span class="o">,</span> <span class="kd">final</span> <span class="n">Rect</span> <span class="n">tfocusRect</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">camera</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">isFoucuing</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Camera</span><span class="o">.</span><span class="na">Area</span><span class="o">&gt;</span> <span class="n">focusList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">            <span class="n">Camera</span><span class="o">.</span><span class="na">Area</span> <span class="n">focusArea</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Camera</span><span class="o">.</span><span class="na">Area</span><span class="o">(</span><span class="n">tfocusRect</span><span class="o">,</span> <span class="mi">1000</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">focusList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">focusArea</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">Camera</span><span class="o">.</span><span class="na">Parameters</span> <span class="n">para</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="na">getParameters</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="n">para</span><span class="o">.</span><span class="na">setFocusAreas</span><span class="o">(</span><span class="n">focusList</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">para</span><span class="o">.</span><span class="na">setMeteringAreas</span><span class="o">(</span><span class="n">focusList</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">para</span><span class="o">.</span><span class="na">setFocusMode</span><span class="o">(</span><span class="n">Camera</span><span class="o">.</span><span class="na">Parameters</span><span class="o">.</span><span class="na">FOCUS_MODE_AUTO</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">camera</span><span class="o">.</span><span class="na">cancelAutoFocus</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="n">camera</span><span class="o">.</span><span class="na">setParameters</span><span class="o">(</span><span class="n">para</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">camera</span><span class="o">.</span><span class="na">autoFocus</span><span class="o">(</span><span class="n">autoFocusCallback</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">isFoucuing</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">XyzLogger</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">&#34;è®¾ç½®ç›¸æœºå‚æ•°å¼‚å¸¸&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ³¨é‡Šï¼šå¯¹ç„¦å®Œæˆåï¼Œæ¸…é™¤å¯¹ç„¦çŸ©å½¢æ¡†
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ—¶é—´ï¼š2019/3/1 0001 9:28
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ä½œè€…ï¼šéƒ­ç¿°æ—
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">disDrawTouchFocusRect</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//å°†å¯¹ç„¦åŒºåŸŸè®¾ç½®ä¸ºnullï¼Œåˆ·æ–°ç•Œé¢åå¯¹ç„¦æ¡†æ¶ˆå¤±
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">touchFocusRect</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//åˆ·æ–°ç•Œé¢ï¼Œè°ƒç”¨onDraw(Canvas canvas)å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">postInvalidate</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onDraw</span><span class="o">(</span><span class="n">Canvas</span> <span class="n">canvas</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//åœ¨ç”»å¸ƒä¸Šç»˜å›¾ï¼ŒpostInvalidate()åè‡ªåŠ¨è°ƒç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">drawTouchFocusRect</span><span class="o">(</span><span class="n">canvas</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="kd">super</span><span class="o">.</span><span class="na">onDraw</span><span class="o">(</span><span class="n">canvas</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * è·å–å±å¹•é«˜åº¦
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&#34;deprecation&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">getWindowHeight</span><span class="o">(</span><span class="n">Context</span> <span class="n">cxt</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">WindowManager</span> <span class="n">wm</span> <span class="o">=</span> <span class="o">(</span><span class="n">WindowManager</span><span class="o">)</span> <span class="n">cxt</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">getSystemService</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">WINDOW_SERVICE</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">wm</span><span class="o">.</span><span class="na">getDefaultDisplay</span><span class="o">().</span><span class="na">getHeight</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * è·å–å±å¹•å®½åº¦
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&#34;deprecation&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">getWindowWidth</span><span class="o">(</span><span class="n">Context</span> <span class="n">cxt</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">WindowManager</span> <span class="n">wm</span> <span class="o">=</span> <span class="o">(</span><span class="n">WindowManager</span><span class="o">)</span> <span class="n">cxt</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">getSystemService</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">WINDOW_SERVICE</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">wm</span><span class="o">.</span><span class="na">getDefaultDisplay</span><span class="o">().</span><span class="na">getWidth</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">drawTouchFocusRect</span><span class="o">(</span><span class="n">Canvas</span> <span class="n">canvas</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">touchFocusRect</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//æ ¹æ®å¯¹ç„¦åŒºåŸŸtargetFocusRectï¼Œç»˜åˆ¶è‡ªå·±æƒ³è¦çš„å¯¹ç„¦æ¡†æ ·å¼ï¼Œæœ¬æ–‡åœ¨çŸ©å½¢å››ä¸ªè§’å–Lå½¢çŠ¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">//å·¦ä¸‹è§’
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">canvas</span><span class="o">.</span><span class="na">drawRect</span><span class="o">(</span><span class="n">touchFocusRect</span><span class="o">.</span><span class="na">left</span> <span class="o">-</span> <span class="mi">2</span><span class="o">,</span> <span class="n">touchFocusRect</span><span class="o">.</span><span class="na">bottom</span><span class="o">,</span> <span class="n">touchFocusRect</span><span class="o">.</span><span class="na">left</span> <span class="o">+</span> <span class="mi">20</span><span class="o">,</span> <span class="n">touchFocusRect</span><span class="o">.</span><span class="na">bottom</span> <span class="o">+</span> <span class="mi">2</span><span class="o">,</span> <span class="n">touchFocusPaint</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">canvas</span><span class="o">.</span><span class="na">drawRect</span><span class="o">(</span><span class="n">touchFocusRect</span><span class="o">.</span><span class="na">left</span> <span class="o">-</span> <span class="mi">2</span><span class="o">,</span> <span class="n">touchFocusRect</span><span class="o">.</span><span class="na">bottom</span> <span class="o">-</span> <span class="mi">20</span><span class="o">,</span> <span class="n">touchFocusRect</span><span class="o">.</span><span class="na">left</span><span class="o">,</span> <span class="n">touchFocusRect</span><span class="o">.</span><span class="na">bottom</span><span class="o">,</span> <span class="n">touchFocusPaint</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//å·¦ä¸Šè§’
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">canvas</span><span class="o">.</span><span class="na">drawRect</span><span class="o">(</span><span class="n">touchFocusRect</span><span class="o">.</span><span class="na">left</span> <span class="o">-</span> <span class="mi">2</span><span class="o">,</span> <span class="n">touchFocusRect</span><span class="o">.</span><span class="na">top</span> <span class="o">-</span> <span class="mi">2</span><span class="o">,</span> <span class="n">touchFocusRect</span><span class="o">.</span><span class="na">left</span> <span class="o">+</span> <span class="mi">20</span><span class="o">,</span> <span class="n">touchFocusRect</span><span class="o">.</span><span class="na">top</span><span class="o">,</span> <span class="n">touchFocusPaint</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">canvas</span><span class="o">.</span><span class="na">drawRect</span><span class="o">(</span><span class="n">touchFocusRect</span><span class="o">.</span><span class="na">left</span> <span class="o">-</span> <span class="mi">2</span><span class="o">,</span> <span class="n">touchFocusRect</span><span class="o">.</span><span class="na">top</span><span class="o">,</span> <span class="n">touchFocusRect</span><span class="o">.</span><span class="na">left</span><span class="o">,</span> <span class="n">touchFocusRect</span><span class="o">.</span><span class="na">top</span> <span class="o">+</span> <span class="mi">20</span><span class="o">,</span> <span class="n">touchFocusPaint</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//å³ä¸Šè§’
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">canvas</span><span class="o">.</span><span class="na">drawRect</span><span class="o">(</span><span class="n">touchFocusRect</span><span class="o">.</span><span class="na">right</span> <span class="o">-</span> <span class="mi">20</span><span class="o">,</span> <span class="n">touchFocusRect</span><span class="o">.</span><span class="na">top</span> <span class="o">-</span> <span class="mi">2</span><span class="o">,</span> <span class="n">touchFocusRect</span><span class="o">.</span><span class="na">right</span> <span class="o">+</span> <span class="mi">2</span><span class="o">,</span> <span class="n">touchFocusRect</span><span class="o">.</span><span class="na">top</span><span class="o">,</span> <span class="n">touchFocusPaint</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">canvas</span><span class="o">.</span><span class="na">drawRect</span><span class="o">(</span><span class="n">touchFocusRect</span><span class="o">.</span><span class="na">right</span><span class="o">,</span> <span class="n">touchFocusRect</span><span class="o">.</span><span class="na">top</span><span class="o">,</span> <span class="n">touchFocusRect</span><span class="o">.</span><span class="na">right</span> <span class="o">+</span> <span class="mi">2</span><span class="o">,</span> <span class="n">touchFocusRect</span><span class="o">.</span><span class="na">top</span> <span class="o">+</span> <span class="mi">20</span><span class="o">,</span> <span class="n">touchFocusPaint</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//å³ä¸‹è§’
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">canvas</span><span class="o">.</span><span class="na">drawRect</span><span class="o">(</span><span class="n">touchFocusRect</span><span class="o">.</span><span class="na">right</span> <span class="o">-</span> <span class="mi">20</span><span class="o">,</span> <span class="n">touchFocusRect</span><span class="o">.</span><span class="na">bottom</span><span class="o">,</span> <span class="n">touchFocusRect</span><span class="o">.</span><span class="na">right</span> <span class="o">+</span> <span class="mi">2</span><span class="o">,</span> <span class="n">touchFocusRect</span><span class="o">.</span><span class="na">bottom</span> <span class="o">+</span> <span class="mi">2</span><span class="o">,</span> <span class="n">touchFocusPaint</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">canvas</span><span class="o">.</span><span class="na">drawRect</span><span class="o">(</span><span class="n">touchFocusRect</span><span class="o">.</span><span class="na">right</span><span class="o">,</span> <span class="n">touchFocusRect</span><span class="o">.</span><span class="na">bottom</span> <span class="o">-</span> <span class="mi">20</span><span class="o">,</span> <span class="n">touchFocusRect</span><span class="o">.</span><span class="na">right</span> <span class="o">+</span> <span class="mi">2</span><span class="o">,</span> <span class="n">touchFocusRect</span><span class="o">.</span><span class="na">bottom</span><span class="o">,</span> <span class="n">touchFocusPaint</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h6 id="2åœ¨activityä¸­çš„ontoucheventå‡½æ•°ä¸­è§¦å‘ç›¸æœºèšç„¦">ï¼ˆ2ï¼‰åœ¨Activityä¸­çš„onTouchEventå‡½æ•°ä¸­è§¦å‘ç›¸æœºèšç„¦</h6>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onTouchEvent</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">getAction</span><span class="o">()</span> <span class="o">==</span> <span class="n">MotionEvent</span><span class="o">.</span><span class="na">ACTION_DOWN</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(!</span><span class="n">isFoucing</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getX</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="kt">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getY</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="n">isFoucing</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">mCamera</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">isTakePhoto</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">mOverCameraView</span><span class="o">.</span><span class="na">setTouchFoucusRect</span><span class="o">(</span><span class="n">mCamera</span><span class="o">,</span> <span class="n">autoFocusCallback</span><span class="o">,</span> <span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">mRunnable</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">ToastUtil</span><span class="o">.</span><span class="na">showToast</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s">&#34;è‡ªåŠ¨èšç„¦è¶…æ—¶,è¯·è°ƒæ•´åˆé€‚çš„ä½ç½®æ‹æ‘„ï¼&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">isFoucing</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="n">mOverCameraView</span><span class="o">.</span><span class="na">setFoucuing</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">mOverCameraView</span><span class="o">.</span><span class="na">disDrawTouchFocusRect</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">};</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//è®¾ç½®èšç„¦è¶…æ—¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">mHandler</span><span class="o">.</span><span class="na">postDelayed</span><span class="o">(</span><span class="n">mRunnable</span><span class="o">,</span> <span class="mi">3000</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">onTouchEvent</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * æ³¨é‡Šï¼šè‡ªåŠ¨å¯¹ç„¦å›è°ƒ
</span></span></span><span class="line"><span class="cl"><span class="cm"> * æ—¶é—´ï¼š2019/3/1 0001 10:02
</span></span></span><span class="line"><span class="cl"><span class="cm"> * ä½œè€…ï¼šéƒ­ç¿°æ—
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="n">Camera</span><span class="o">.</span><span class="na">AutoFocusCallback</span> <span class="n">autoFocusCallback</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Camera</span><span class="o">.</span><span class="na">AutoFocusCallback</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onAutoFocus</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">success</span><span class="o">,</span> <span class="n">Camera</span> <span class="n">camera</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">isFoucing</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">mOverCameraView</span><span class="o">.</span><span class="na">setFoucuing</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">mOverCameraView</span><span class="o">.</span><span class="na">disDrawTouchFocusRect</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//åœæ­¢èšç„¦è¶…æ—¶å›è°ƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">mHandler</span><span class="o">.</span><span class="na">removeCallbacks</span><span class="o">(</span><span class="n">mRunnable</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ä¸‰è‡ªå®šä¹‰ç›¸æœºå¸ƒå±€">ä¸‰ã€è‡ªå®šä¹‰ç›¸æœºå¸ƒå±€</h3>
<h6 id="1è‡ªå®šä¹‰ç›¸æœºé¢„è§ˆ">ï¼ˆ1ï¼‰è‡ªå®šä¹‰ç›¸æœºé¢„è§ˆ</h6>
<p><img src="/images/camre_screen_1.webp"
	
	
	
	loading="lazy"
	
	
></p>
<p><img src="/images/camre_screen_2.webp"
	
	
	
	loading="lazy"
	
	
></p>
<h6 id="2è‡ªå®šä¹‰ç›¸æœºå®ç°ä»£ç ">ï¼ˆ2ï¼‰è‡ªå®šä¹‰ç›¸æœºå®ç°ä»£ç </h6>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span><span class="lnt">375
</span><span class="lnt">376
</span><span class="lnt">377
</span><span class="lnt">378
</span><span class="lnt">379
</span><span class="lnt">380
</span><span class="lnt">381
</span><span class="lnt">382
</span><span class="lnt">383
</span><span class="lnt">384
</span><span class="lnt">385
</span><span class="lnt">386
</span><span class="lnt">387
</span><span class="lnt">388
</span><span class="lnt">389
</span><span class="lnt">390
</span><span class="lnt">391
</span><span class="lnt">392
</span><span class="lnt">393
</span><span class="lnt">394
</span><span class="lnt">395
</span><span class="lnt">396
</span><span class="lnt">397
</span><span class="lnt">398
</span><span class="lnt">399
</span><span class="lnt">400
</span><span class="lnt">401
</span><span class="lnt">402
</span><span class="lnt">403
</span><span class="lnt">404
</span><span class="lnt">405
</span><span class="lnt">406
</span><span class="lnt">407
</span><span class="lnt">408
</span><span class="lnt">409
</span><span class="lnt">410
</span><span class="lnt">411
</span><span class="lnt">412
</span><span class="lnt">413
</span><span class="lnt">414
</span><span class="lnt">415
</span><span class="lnt">416
</span><span class="lnt">417
</span><span class="lnt">418
</span><span class="lnt">419
</span><span class="lnt">420
</span><span class="lnt">421
</span><span class="lnt">422
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">com.focustech.xyz.baselibrary.camera</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.app.Activity</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.content.Context</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.hardware.Camera</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.os.Environment</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.os.Handler</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.support.annotation.Nullable</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.support.v7.app.AppCompatActivity</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.view.MotionEvent</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.view.View</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.widget.Button</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.widget.FrameLayout</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.widget.ImageView</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">android.widget.RelativeLayout</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.bumptech.glide.Glide</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.focustech.xyz.baselibrary.R</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.focustech.xyz.baselibrary.utils.PermissionUtils</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.focustech.xyz.baselibrary.utils.ToastUtil</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.newland.springdialog.AnimSpring</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.yanzhenjie.permission.AndPermission</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.yanzhenjie.permission.Permission</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.io.FileOutputStream</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @author éƒ­ç¿°æ—
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @date 2019/2/28 0028 16:23
</span></span></span><span class="line"><span class="cl"><span class="cm"> * æ³¨é‡Š:Androidè‡ªå®šä¹‰ç›¸æœº
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CameraActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="kd">implements</span> <span class="n">View</span><span class="o">.</span><span class="na">OnClickListener</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">KEY_IMAGE_PATH</span> <span class="o">=</span> <span class="s">&#34;imagePath&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ç›¸æœºé¢„è§ˆ
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">FrameLayout</span> <span class="n">mPreviewLayout</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ‹æ‘„æŒ‰é’®è§†å›¾
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">RelativeLayout</span> <span class="n">mPhotoLayout</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ç¡®å®šæŒ‰é’®è§†å›¾
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">RelativeLayout</span> <span class="n">mConfirmLayout</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * é—ªå…‰ç¯
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">ImageView</span> <span class="n">mFlashButton</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ‹ç…§æŒ‰é’®
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">ImageView</span> <span class="n">mPhotoButton</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * å–æ¶ˆä¿å­˜æŒ‰é’®
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">ImageView</span> <span class="n">mCancleSaveButton</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ä¿å­˜æŒ‰é’®
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">ImageView</span> <span class="n">mSaveButton</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * èšç„¦è§†å›¾
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">OverCameraView</span> <span class="n">mOverCameraView</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ç›¸æœºç±»
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Camera</span> <span class="n">mCamera</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * Handle
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Handler</span> <span class="n">mHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Handler</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Runnable</span> <span class="n">mRunnable</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * å–æ¶ˆæŒ‰é’®
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Button</span> <span class="n">mCancleButton</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ˜¯å¦å¼€å¯é—ªå…‰ç¯
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">isFlashing</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * å›¾ç‰‡æµæš‚å­˜
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">imageData</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ‹ç…§æ ‡è®°
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">isTakePhoto</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ˜¯å¦æ­£åœ¨èšç„¦
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">isFoucing</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * è’™ç‰ˆç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">MongolianLayerType</span> <span class="n">mMongolianLayerType</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * è’™ç‰ˆå›¾ç‰‡
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">ImageView</span> <span class="n">mMaskImage</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æŠ¤ç…§å‡ºå…¥å¢ƒè’™ç‰ˆ
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">ImageView</span> <span class="n">mPassportEntryAndExitImage</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æç¤ºæ–‡æ¡ˆå®¹å™¨
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">RelativeLayout</span> <span class="n">rlCameraTip</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_camre_layout</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">mMongolianLayerType</span> <span class="o">=</span> <span class="o">(</span><span class="n">MongolianLayerType</span><span class="o">)</span> <span class="n">getIntent</span><span class="o">().</span><span class="na">getSerializableExtra</span><span class="o">(</span><span class="s">&#34;MongolianLayerType&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">PermissionUtils</span><span class="o">.</span><span class="na">applicationPermissions</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="k">new</span> <span class="n">PermissionUtils</span><span class="o">.</span><span class="na">PermissionListener</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onSuccess</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">initView</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="n">setOnclickListener</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFailed</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">AndPermission</span><span class="o">.</span><span class="na">hasAlwaysDeniedPermission</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">Permission</span><span class="o">.</span><span class="na">Group</span><span class="o">.</span><span class="na">CAMERA</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                        <span class="o">&amp;&amp;</span> <span class="n">AndPermission</span><span class="o">.</span><span class="na">hasAlwaysDeniedPermission</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">Permission</span><span class="o">.</span><span class="na">Group</span><span class="o">.</span><span class="na">STORAGE</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">AndPermission</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">context</span><span class="o">).</span><span class="na">runtime</span><span class="o">().</span><span class="na">setting</span><span class="o">().</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="n">ToastUtil</span><span class="o">.</span><span class="na">showToast</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">context</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">com</span><span class="o">.</span><span class="na">focustech</span><span class="o">.</span><span class="na">xyz</span><span class="o">.</span><span class="na">baselibrary</span><span class="o">.</span><span class="na">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">permission_camra_storage</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">                <span class="n">finish</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">},</span> <span class="n">Permission</span><span class="o">.</span><span class="na">Group</span><span class="o">.</span><span class="na">STORAGE</span><span class="o">,</span> <span class="n">Permission</span><span class="o">.</span><span class="na">Group</span><span class="o">.</span><span class="na">CAMERA</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * å¯åŠ¨æ‹ç…§ç•Œé¢
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param activity
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param requestCode
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param type
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">startMe</span><span class="o">(</span><span class="n">Activity</span> <span class="n">activity</span><span class="o">,</span> <span class="kt">int</span> <span class="n">requestCode</span><span class="o">,</span> <span class="n">MongolianLayerType</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="n">activity</span><span class="o">,</span> <span class="n">CameraActivity</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">intent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">&#34;MongolianLayerType&#34;</span><span class="o">,</span> <span class="n">type</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">activity</span><span class="o">.</span><span class="na">startActivityForResult</span><span class="o">(</span><span class="n">intent</span><span class="o">,</span> <span class="n">requestCode</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ³¨é‡Šï¼šè·å–è’™ç‰ˆå›¾ç‰‡
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ—¶é—´ï¼š2019/3/4 0004 17:19
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ä½œè€…ï¼šéƒ­ç¿°æ—
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">int</span> <span class="nf">getMaskImage</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">mMongolianLayerType</span> <span class="o">==</span> <span class="n">MongolianLayerType</span><span class="o">.</span><span class="na">BANK_CARD</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">R</span><span class="o">.</span><span class="na">mipmap</span><span class="o">.</span><span class="na">bank_card</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">mMongolianLayerType</span> <span class="o">==</span> <span class="n">MongolianLayerType</span><span class="o">.</span><span class="na">HK_MACAO_TAIWAN_PASSES_POSITIVE</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">R</span><span class="o">.</span><span class="na">mipmap</span><span class="o">.</span><span class="na">hk_macao_taiwan_passes_positive</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">mMongolianLayerType</span> <span class="o">==</span> <span class="n">MongolianLayerType</span><span class="o">.</span><span class="na">HK_MACAO_TAIWAN_PASSES_NEGATIVE</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">R</span><span class="o">.</span><span class="na">mipmap</span><span class="o">.</span><span class="na">hk_macao_taiwan_passes_negative</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">mMongolianLayerType</span> <span class="o">==</span> <span class="n">MongolianLayerType</span><span class="o">.</span><span class="na">IDCARD_POSITIVE</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">R</span><span class="o">.</span><span class="na">mipmap</span><span class="o">.</span><span class="na">idcard_positive</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">mMongolianLayerType</span> <span class="o">==</span> <span class="n">MongolianLayerType</span><span class="o">.</span><span class="na">IDCARD_NEGATIVE</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">R</span><span class="o">.</span><span class="na">mipmap</span><span class="o">.</span><span class="na">idcard_negative</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">mMongolianLayerType</span> <span class="o">==</span> <span class="n">MongolianLayerType</span><span class="o">.</span><span class="na">PASSPORT_PERSON_INFO</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">R</span><span class="o">.</span><span class="na">mipmap</span><span class="o">.</span><span class="na">passport_person_info</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ³¨é‡Šï¼šè®¾ç½®ç›‘å¬äº‹ä»¶
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ—¶é—´ï¼š2019/3/1 0001 11:13
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ä½œè€…ï¼šéƒ­ç¿°æ—
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">setOnclickListener</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">mCancleButton</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">mCancleSaveButton</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">mFlashButton</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">mPhotoButton</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">mSaveButton</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onTouchEvent</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">getAction</span><span class="o">()</span> <span class="o">==</span> <span class="n">MotionEvent</span><span class="o">.</span><span class="na">ACTION_DOWN</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(!</span><span class="n">isFoucing</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getX</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="kt">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getY</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="n">isFoucing</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">mCamera</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">isTakePhoto</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">mOverCameraView</span><span class="o">.</span><span class="na">setTouchFoucusRect</span><span class="o">(</span><span class="n">mCamera</span><span class="o">,</span> <span class="n">autoFocusCallback</span><span class="o">,</span> <span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="n">mRunnable</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">ToastUtil</span><span class="o">.</span><span class="na">showToast</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s">&#34;è‡ªåŠ¨èšç„¦è¶…æ—¶,è¯·è°ƒæ•´åˆé€‚çš„ä½ç½®æ‹æ‘„ï¼&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                    <span class="n">isFoucing</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                    <span class="n">mOverCameraView</span><span class="o">.</span><span class="na">setFoucuing</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                    <span class="n">mOverCameraView</span><span class="o">.</span><span class="na">disDrawTouchFocusRect</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="o">};</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//è®¾ç½®èšç„¦è¶…æ—¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">mHandler</span><span class="o">.</span><span class="na">postDelayed</span><span class="o">(</span><span class="n">mRunnable</span><span class="o">,</span> <span class="mi">3000</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">onTouchEvent</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ³¨é‡Šï¼šè‡ªåŠ¨å¯¹ç„¦å›è°ƒ
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ—¶é—´ï¼š2019/3/1 0001 10:02
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ä½œè€…ï¼šéƒ­ç¿°æ—
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Camera</span><span class="o">.</span><span class="na">AutoFocusCallback</span> <span class="n">autoFocusCallback</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Camera</span><span class="o">.</span><span class="na">AutoFocusCallback</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onAutoFocus</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">success</span><span class="o">,</span> <span class="n">Camera</span> <span class="n">camera</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">isFoucing</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">mOverCameraView</span><span class="o">.</span><span class="na">setFoucuing</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">mOverCameraView</span><span class="o">.</span><span class="na">disDrawTouchFocusRect</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//åœæ­¢èšç„¦è¶…æ—¶å›è°ƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">mHandler</span><span class="o">.</span><span class="na">removeCallbacks</span><span class="o">(</span><span class="n">mRunnable</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ³¨é‡Šï¼šæ‹ç…§å¹¶ä¿å­˜å›¾ç‰‡åˆ°ç›¸å†Œ
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ—¶é—´ï¼š2019/3/1 0001 15:37
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ä½œè€…ï¼šéƒ­ç¿°æ—
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">takePhoto</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">isTakePhoto</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//è°ƒç”¨ç›¸æœºæ‹ç…§
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">mCamera</span><span class="o">.</span><span class="na">takePicture</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">camera1</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//è§†å›¾åŠ¨ç”»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">mPhotoLayout</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">GONE</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">mConfirmLayout</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">AnimSpring</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">mConfirmLayout</span><span class="o">).</span><span class="na">startRotateAnim</span><span class="o">(</span><span class="mi">120</span><span class="o">,</span> <span class="mi">360</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">imageData</span> <span class="o">=</span> <span class="n">data</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//åœæ­¢é¢„è§ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">mCamera</span><span class="o">.</span><span class="na">stopPreview</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">});</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ³¨é‡Šï¼šåˆ‡æ¢é—ªå…‰ç¯
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ—¶é—´ï¼š2019/3/1 0001 15:40
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ä½œè€…ï¼šéƒ­ç¿°æ—
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">switchFlash</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">isFlashing</span> <span class="o">=</span> <span class="o">!</span><span class="n">isFlashing</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">mFlashButton</span><span class="o">.</span><span class="na">setImageResource</span><span class="o">(</span><span class="n">isFlashing</span> <span class="o">?</span> <span class="n">R</span><span class="o">.</span><span class="na">mipmap</span><span class="o">.</span><span class="na">flash_open</span> <span class="o">:</span> <span class="n">R</span><span class="o">.</span><span class="na">mipmap</span><span class="o">.</span><span class="na">flash_close</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">AnimSpring</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">mFlashButton</span><span class="o">).</span><span class="na">startRotateAnim</span><span class="o">(</span><span class="mi">120</span><span class="o">,</span> <span class="mi">360</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Camera</span><span class="o">.</span><span class="na">Parameters</span> <span class="n">parameters</span> <span class="o">=</span> <span class="n">mCamera</span><span class="o">.</span><span class="na">getParameters</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="n">parameters</span><span class="o">.</span><span class="na">setFlashMode</span><span class="o">(</span><span class="n">isFlashing</span> <span class="o">?</span> <span class="n">Camera</span><span class="o">.</span><span class="na">Parameters</span><span class="o">.</span><span class="na">FLASH_MODE_TORCH</span> <span class="o">:</span> <span class="n">Camera</span><span class="o">.</span><span class="na">Parameters</span><span class="o">.</span><span class="na">FLASH_MODE_OFF</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">mCamera</span><span class="o">.</span><span class="na">setParameters</span><span class="o">(</span><span class="n">parameters</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">ToastUtil</span><span class="o">.</span><span class="na">showToast</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s">&#34;è¯¥è®¾å¤‡ä¸æ”¯æŒé—ªå…‰ç¯&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ³¨é‡Šï¼šå–æ¶ˆä¿å­˜
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ—¶é—´ï¼š2019/3/1 0001 16:31
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ä½œè€…ï¼šéƒ­ç¿°æ—
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">cancleSavePhoto</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">mPhotoLayout</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">mConfirmLayout</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">GONE</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">AnimSpring</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">mPhotoLayout</span><span class="o">).</span><span class="na">startRotateAnim</span><span class="o">(</span><span class="mi">120</span><span class="o">,</span> <span class="mi">360</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//å¼€å§‹é¢„è§ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">mCamera</span><span class="o">.</span><span class="na">startPreview</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">imageData</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">isTakePhoto</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * è§£ææ‹å‡ºç…§ç‰‡çš„è·¯å¾„
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param data
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">parseResult</span><span class="o">(</span><span class="n">Intent</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="na">getStringExtra</span><span class="o">(</span><span class="n">KEY_IMAGE_PATH</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">cancle_button</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">finish</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">take_photo_button</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(!</span><span class="n">isTakePhoto</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">takePhoto</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">flash_button</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">switchFlash</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">save_button</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">savePhoto</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">cancle_save_button</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">cancleSavePhoto</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ³¨é‡Šï¼šè’™ç‰ˆç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ—¶é—´ï¼š2019/2/28 0028 16:26
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ä½œè€…ï¼šéƒ­ç¿°æ—
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">enum</span> <span class="n">MongolianLayerType</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">         * æŠ¤ç…§ä¸ªäººä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="cm">         */</span>
</span></span><span class="line"><span class="cl">        <span class="n">PASSPORT_PERSON_INFO</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">         * æŠ¤ç…§å‡ºå…¥å¢ƒ
</span></span></span><span class="line"><span class="cl"><span class="cm">         */</span>
</span></span><span class="line"><span class="cl">        <span class="n">PASSPORT_ENTRY_AND_EXIT</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">         * èº«ä»½è¯æ­£é¢
</span></span></span><span class="line"><span class="cl"><span class="cm">         */</span>
</span></span><span class="line"><span class="cl">        <span class="n">IDCARD_POSITIVE</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">         * èº«ä»½è¯åé¢
</span></span></span><span class="line"><span class="cl"><span class="cm">         */</span>
</span></span><span class="line"><span class="cl">        <span class="n">IDCARD_NEGATIVE</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">         * æ¸¯æ¾³é€šè¡Œè¯æ­£é¢
</span></span></span><span class="line"><span class="cl"><span class="cm">         */</span>
</span></span><span class="line"><span class="cl">        <span class="n">HK_MACAO_TAIWAN_PASSES_POSITIVE</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">         * æ¸¯æ¾³é€šè¡Œè¯åé¢
</span></span></span><span class="line"><span class="cl"><span class="cm">         */</span>
</span></span><span class="line"><span class="cl">        <span class="n">HK_MACAO_TAIWAN_PASSES_NEGATIVE</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">         * é“¶è¡Œå¡
</span></span></span><span class="line"><span class="cl"><span class="cm">         */</span>
</span></span><span class="line"><span class="cl">        <span class="n">BANK_CARD</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ³¨é‡Šï¼šåˆå§‹åŒ–è§†å›¾
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ—¶é—´ï¼š2019/3/1 0001 11:12
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ä½œè€…ï¼šéƒ­ç¿°æ—
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">initView</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">mCancleButton</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">cancle_button</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">mPreviewLayout</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">camera_preview_layout</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">mPhotoLayout</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">ll_photo_layout</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">mConfirmLayout</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">ll_confirm_layout</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">mPhotoButton</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">take_photo_button</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">mCancleSaveButton</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">cancle_save_button</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">mSaveButton</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">save_button</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">mFlashButton</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">flash_button</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">mMaskImage</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">mask_img</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">rlCameraTip</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">camera_tip</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">mPassportEntryAndExitImage</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">passport_entry_and_exit_img</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">mCamera</span> <span class="o">=</span> <span class="n">Camera</span><span class="o">.</span><span class="na">open</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">CameraPreview</span> <span class="n">preview</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CameraPreview</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">mCamera</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">mOverCameraView</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OverCameraView</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">mPreviewLayout</span><span class="o">.</span><span class="na">addView</span><span class="o">(</span><span class="n">preview</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">mPreviewLayout</span><span class="o">.</span><span class="na">addView</span><span class="o">(</span><span class="n">mOverCameraView</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">mMongolianLayerType</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">mMaskImage</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">GONE</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">rlCameraTip</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">GONE</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//è®¾ç½®è’™ç‰ˆ,æŠ¤ç…§å‡ºå…¥å¢ƒè’™ç‰ˆç‰¹æ®Šå¤„ç†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">mMongolianLayerType</span> <span class="o">!=</span> <span class="n">MongolianLayerType</span><span class="o">.</span><span class="na">PASSPORT_ENTRY_AND_EXIT</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Glide</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="k">this</span><span class="o">).</span><span class="na">load</span><span class="o">(</span><span class="n">getMaskImage</span><span class="o">()).</span><span class="na">into</span><span class="o">(</span><span class="n">mMaskImage</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">mMaskImage</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">GONE</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">mPassportEntryAndExitImage</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ³¨é‡Šï¼šä¿æŒå›¾ç‰‡
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ—¶é—´ï¼š2019/3/1 0001 16:32
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ä½œè€…ï¼šéƒ­ç¿°æ—
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">savePhoto</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">FileOutputStream</span> <span class="n">fos</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">String</span> <span class="n">cameraPath</span> <span class="o">=</span> <span class="n">Environment</span><span class="o">.</span><span class="na">getExternalStorageDirectory</span><span class="o">().</span><span class="na">getPath</span><span class="o">()</span> <span class="o">+</span> <span class="n">File</span><span class="o">.</span><span class="na">separator</span> <span class="o">+</span> <span class="s">&#34;DCIM&#34;</span> <span class="o">+</span> <span class="n">File</span><span class="o">.</span><span class="na">separator</span> <span class="o">+</span> <span class="s">&#34;Camera&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//ç›¸å†Œæ–‡ä»¶å¤¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">File</span> <span class="n">cameraFolder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">cameraPath</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(!</span><span class="n">cameraFolder</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">cameraFolder</span><span class="o">.</span><span class="na">mkdirs</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//ä¿å­˜çš„å›¾ç‰‡æ–‡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">SimpleDateFormat</span> <span class="n">simpleDateFormat</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDateFormat</span><span class="o">(</span><span class="s">&#34;yyyyMMdd_HHmmss&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">String</span> <span class="n">imagePath</span> <span class="o">=</span> <span class="n">cameraFolder</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">()</span> <span class="o">+</span> <span class="n">File</span><span class="o">.</span><span class="na">separator</span> <span class="o">+</span> <span class="s">&#34;IMG_&#34;</span> <span class="o">+</span> <span class="n">simpleDateFormat</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">())</span> <span class="o">+</span> <span class="s">&#34;.jpg&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">File</span> <span class="n">imageFile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">imagePath</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">fos</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileOutputStream</span><span class="o">(</span><span class="n">imageFile</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">fos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">imageData</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">fos</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">fos</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                    <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                    <span class="n">intent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="n">KEY_IMAGE_PATH</span><span class="o">,</span> <span class="n">imagePath</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                    <span class="n">setResult</span><span class="o">(</span><span class="n">RESULT_OK</span><span class="o">,</span> <span class="n">intent</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">setResult</span><span class="o">(</span><span class="n">RESULT_FIRST_USER</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">finish</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Activityè‡ªå®šä¹‰å¸ƒå±€ <code>R.layout.activity_camre_layout</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;RelativeLayout</span> <span class="na">xmlns:android=</span><span class="s">&#34;http://schemas.android.com/apk/res/android&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">android:layout_width=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">android:layout_height=</span><span class="s">&#34;match_parent&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--ç›¸æœºé¢„è§ˆè§†å›¾--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;FrameLayout</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:id=</span><span class="s">&#34;@+id/camera_preview_layout&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_width=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_height=</span><span class="s">&#34;match_parent&#34;</span><span class="nt">&gt;&lt;/FrameLayout&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--è’™ç‰ˆåŒºåŸŸ--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;LinearLayout</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_width=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_height=</span><span class="s">&#34;wrap_content&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_centerInParent=</span><span class="s">&#34;true&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:orientation=</span><span class="s">&#34;vertical&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!--æç¤ºæ–‡å­—--&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;RelativeLayout</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:id=</span><span class="s">&#34;@+id/camera_tip&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_width=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_height=</span><span class="s">&#34;wrap_content&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;TextView</span>
</span></span><span class="line"><span class="cl">                <span class="na">android:layout_width=</span><span class="s">&#34;wrap_content&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="na">android:layout_height=</span><span class="s">&#34;wrap_content&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="na">android:layout_centerInParent=</span><span class="s">&#34;true&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="na">android:background=</span><span class="s">&#34;@drawable/tip_layout_shape&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="na">android:gravity=</span><span class="s">&#34;center&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="na">android:text=</span><span class="s">&#34;è¯·å‚ç…§è¾…åŠ©çº¿è¿›è¡Œæ‹æ‘„&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="na">android:textColor=</span><span class="s">&#34;#fff&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="na">android:textSize=</span><span class="s">&#34;12sp&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/RelativeLayout&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!--è’™ç‰ˆå›¾ç‰‡--&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;ImageView</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:id=</span><span class="s">&#34;@+id/mask_img&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_width=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_height=</span><span class="s">&#34;wrap_content&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_marginLeft=</span><span class="s">&#34;20dp&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_marginTop=</span><span class="s">&#34;25dp&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_marginRight=</span><span class="s">&#34;20dp&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:scaleType=</span><span class="s">&#34;fitCenter&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:src=</span><span class="s">&#34;@mipmap/hk_macao_taiwan_passes_positive&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:visibility=</span><span class="s">&#34;visible&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;ImageView</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:id=</span><span class="s">&#34;@+id/passport_entry_and_exit_img&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_width=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_height=</span><span class="s">&#34;wrap_content&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_marginLeft=</span><span class="s">&#34;54dp&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_marginTop=</span><span class="s">&#34;20dp&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_marginRight=</span><span class="s">&#34;54dp&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_marginBottom=</span><span class="s">&#34;50dp&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:scaleType=</span><span class="s">&#34;fitCenter&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:src=</span><span class="s">&#34;@mipmap/passport_entry_and_exit&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:visibility=</span><span class="s">&#34;gone&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/LinearLayout&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--é¡¶éƒ¨è§†å›¾--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;LinearLayout</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_width=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_height=</span><span class="s">&#34;80dp&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:gravity=</span><span class="s">&#34;bottom&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:orientation=</span><span class="s">&#34;horizontal&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:padding=</span><span class="s">&#34;15dp&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;ImageView</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:id=</span><span class="s">&#34;@+id/flash_button&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_width=</span><span class="s">&#34;25dp&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_height=</span><span class="s">&#34;25dp&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:src=</span><span class="s">&#34;@mipmap/flash_close&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/LinearLayout&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--æ‹ç…§å®Œæˆç¡®å®šè§†å›¾--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;RelativeLayout</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:id=</span><span class="s">&#34;@+id/ll_confirm_layout&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_width=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_height=</span><span class="s">&#34;150dp&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_alignParentBottom=</span><span class="s">&#34;true&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:padding=</span><span class="s">&#34;50dp&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:visibility=</span><span class="s">&#34;gone&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;ImageView</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:id=</span><span class="s">&#34;@+id/cancle_save_button&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_width=</span><span class="s">&#34;50dp&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_height=</span><span class="s">&#34;50dp&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_centerVertical=</span><span class="s">&#34;true&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:src=</span><span class="s">&#34;@mipmap/failed&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;ImageView</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:id=</span><span class="s">&#34;@+id/save_button&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_width=</span><span class="s">&#34;50dp&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_height=</span><span class="s">&#34;50dp&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_alignParentRight=</span><span class="s">&#34;true&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_centerVertical=</span><span class="s">&#34;true&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:src=</span><span class="s">&#34;@mipmap/success&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/RelativeLayout&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--åº•éƒ¨æ‹ç…§æŒ‰é’®--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;RelativeLayout</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:id=</span><span class="s">&#34;@+id/ll_photo_layout&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_width=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_height=</span><span class="s">&#34;150dp&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_alignParentBottom=</span><span class="s">&#34;true&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:padding=</span><span class="s">&#34;15dp&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:visibility=</span><span class="s">&#34;visible&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;Button</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:id=</span><span class="s">&#34;@+id/cancle_button&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_width=</span><span class="s">&#34;wrap_content&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_height=</span><span class="s">&#34;wrap_content&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_centerVertical=</span><span class="s">&#34;true&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:background=</span><span class="s">&#34;@null&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:text=</span><span class="s">&#34;å–æ¶ˆ&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:textColor=</span><span class="s">&#34;#fff&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:textSize=</span><span class="s">&#34;14sp&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;ImageView</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:id=</span><span class="s">&#34;@+id/take_photo_button&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_width=</span><span class="s">&#34;80dp&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_height=</span><span class="s">&#34;80dp&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_centerInParent=</span><span class="s">&#34;true&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:src=</span><span class="s">&#34;@mipmap/take_button&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/RelativeLayout&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/RelativeLayout&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å››demoé“¾æ¥">å››ã€Demoé“¾æ¥</h3>
<h3 id="æ¬¢è¿star">æ¬¢è¿Star</h3>
<h3 id="githubhttpsgithubcomrmondjoneandroidcamerahttpsgithubcomrmondjoneandroidcamera">GitHub:<a class="link" href="https://github.com/RmondJone/AndroidCamera"  target="_blank" rel="noopener"
    >https://github.com/RmondJone/AndroidCamera</a></h3>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/android/">Android</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">ç›¸å…³æ–‡ç« </h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/posts/mobile/lock_table/">
        
        

        <div class="article-details">
            <h2 class="article-title">Androidä¸€å¥è¯é›†æˆè‡ªå®šä¹‰è¡¨æ ¼</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/posts/mobile/network_proxy_tool/">
        
        

        <div class="article-details">
            <h2 class="article-title">Androidåº”ç”¨å†…ç½‘ç»œæŠ“åŒ…å¿«æ·å·¥å…·å¼€å‘</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/posts/mobile/custom_lock_screen/">
        
        

        <div class="article-details">
            <h2 class="article-title">Androidè‡ªå®šä¹‰é”å±</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src="https://utteranc.es/client.js" 
        repo="RmondJone/RmondJone.github.io"
        issue-term="pathname"
        
        label="Comment"
        
        crossorigin="anonymous"
        async
        >
</script>

<style>
    .utterances {
        max-width: unset;
    }
</style>

<script>
    let utterancesLoaded = false;

    function setUtterancesTheme(theme) {
        let utterances = document.querySelector('.utterances iframe');
        if (utterances) {
            utterances.contentWindow.postMessage(
                {
                    type: 'set-theme',
                    theme: `github-${theme}`
                },
                'https://utteranc.es'
            );
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') return;

        
        utterancesLoaded = true;
        setUtterancesTheme(document.documentElement.dataset.scheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        if (!utterancesLoaded) return;
        setUtterancesTheme(e.detail)
    })
</script>


    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2023 éƒ­ç¿°æ—çš„åšå®¢
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.16.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
